{% extends "layout.html" %}

{% block content %}
<div class="app-layout">
    
    <!-- Top Navigation -->
    <nav class="top-nav">
        <a href="/" class="back-link">
            <span style="font-size: 1.2rem; margin-top: -2px;">â€¹</span> Back
        </a>
        <div class="nav-title">{{ mode|replace('_', ' ')|title }}</div>
        <div class="gem-count" style="display:none;"></div>
    </nav>

    <!-- Chat Area -->
    <div id="chat-box" class="chat-container">
        <!-- Messages will be injected here -->
        <div class="msg ai">Connecting to SpeakUp...</div>
    </div>

    <!-- Feedback Panel -->
    <div id="feedback-panel" class="feedback-overlay">
        <div class="feedback-header">
            <div style="display:flex; align-items:center; gap:10px;">
                <div class="score-circle" id="fb-score">-</div>
                <span style="font-size:0.85rem; font-weight:700; color:#64748b; text-transform:uppercase;">Score</span>
            </div>
            <button onclick="document.getElementById('feedback-panel').classList.remove('visible')" style="background:none; border:none; color:#94a3b8; font-size:1.5rem; cursor:pointer; padding:0;">&times;</button>
        </div>
        
        <div class="feedback-content">
            <div class="correction-box">
                <div class="correction-label">Better Way</div>
                <div class="better-text" id="fb-better">Loading...</div>
            </div>
            <div id="fb-native" style="display:none; margin-top:10px; font-size:0.9rem; color:#be185d; background:#fff1f2; padding:10px; border-radius:10px; align-items:flex-start; gap:8px;">
                <span>ðŸ’¡</span> <span id="fb-native-text"></span>
            </div>
        </div>
    </div>
    
    <!-- Spacer to ensure content isn't hidden by dock -->
    <div class="dock-spacer"></div>

    <!-- MNC Floating Controls -->
    <div class="controls-dock">
        <!-- Audio Visualizer -->
        <div class="visualizer-container" id="viz-container">
            <canvas id="audio-visualizer" width="300" height="30"></canvas>
        </div>
        
        <!-- Robust Mic Button Container -->
        <div class="mic-wrapper">
            <button id="mic-btn" class="mic-button">
                <!-- SVG: Microphone -->
                <svg class="icon-mic" viewBox="0 0 24 24">
                    <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
                    <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
                </svg>
                <!-- SVG: Stop Square (Rounded) -->
                <svg class="icon-stop" viewBox="0 0 24 24">
                    <rect x="6" y="6" width="12" height="12" rx="2" ry="2"/>
                </svg>
            </button>
            <!-- Sonar Ripples sit here -->
            <div class="mic-ripple"></div>
        </div>
        
        <div class="status-label" id="status-text">Tap to Speak</div>
    </div>

</div>

<!-- Logic -->
<script>
    window.APP_MODE = "{{ mode }}";
</script>
<script src="{{ url_for('static', filename='js/app.js') }}"></script>
{% endblock %}